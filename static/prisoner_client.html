<html>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<head>
		<title>Prisoner - Miller Production</title>
		<script>
		
		// sending request to the server by future function, and the arguments to the function
		async function talkToServer(type, input, callback) {
			try {
				const req = await fetch("/ajax", {
					method: 'POST',
					body: JSON.stringify({type: type, input: input})
				})
				const body = await req.text();
				callback(body);
			}
			catch (error) {}
		}
		
		
		
	
		//when pressing the submit button
		function submitButton() {
			var PrisonerNationalId = document.getElementById("PrisonerNationalId").value;
			var Name = document.getElementById("Name").value;
			talkToServer("new_prisoner", JSON.stringify([PrisonerNationalId, Name]), submitButtonResponse);
		}
	
		//after sending the data to the server, showing the response
		function submitButtonResponse(Data) {
			document.getElementById("responseNewPrisoner").innerHTML = "New Prisoner: " + Data;
			// the loop
			const sec = 10
			var intervalID = window.setInterval(LoopCallBack, 1000*sec);
		}
		
		// what the loop does
		function LoopCallBack() {
			navigator.geolocation.getCurrentPosition(showPosition, locationError);
		}
		
		// if got a location - it sends it to the server
		function showPosition(position) {
			var PrisonerNationalId = document.getElementById("PrisonerNationalId").value;
			const CurrentLatitude = position.coords.latitude;
			const CurrentLongitude = position.coords.longitude;
			console.log(CurrentLatitude);
			talkToServer("prisoner_new_location", JSON.stringify([PrisonerNationalId, CurrentLatitude, CurrentLongitude]), UpdateDataToPage);
		}
		// in case of an location_error
		function locationError(errorType) {
			console.log(errorType);	
		}

		
		// after sending the data to the server, showing the response
		function UpdateDataToPage(NewData) {
			document.getElementById("response").innerHTML = "Getting Locations: " + NewData;
		}

		</script>
	</head>
	
	<body style="background-color: aliceblue">
	
		<h1>Prisoner Log In System</h1>
		
		<div>
		
		<form id="NewPrisoner">
			<label for="PrisonerNationalId">Prisoner National ID:</label>
			<input type="text" id="PrisonerNationalId" name="PrisonerNationalId"><br><br>
			
			<label for="Name">Name:</label>
			<input type="text" id="Name" name="Name"><br><br>
		</form>
		
		<button onclick='submitButton()'> Submit </button>
		
		<p id="response"></p>
		<p id="responseNewPrisoner"></p>
	
	</div>
	</body>
</html>